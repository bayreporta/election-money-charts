<link rel="stylesheet" href="http://oaktowndata.com/wp-content/themes/tiny-forge/chosen.css">
<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
<script src="http://oaktowndata.com/wp-content/js/tabletop.js"></script>
<script src="http://oaktowndata.com/wp-content/js/chosen.jquery.js"></script>
<script src="http://oaktowndata.com/wp-content/js/caltip.min.js"></script>
<style>
		#cf-container h1, h2, h3 {
			font-family:"helvetica neue",helvetica,san-serif;
		}
		
		#cf-container {
			height:1000px;
			width:960px;
		}
		
		
		#loading {
			position:relative;
			height:300px;
			width:960px;
			top:0;
			left:0;
			text-align:center;
			margin:100px 0;
		}

		#loading h1 {
			font-size:4.5em;
		}

		#loading p {
			font-family:"helvetica neue",helvetica,san-serif;
			font-size:3em;
		}


		#cand-nointerface {
			display:none;
		}
	/* --------STACKED BAR--------  */

		#cf-stacked {
			display:none;
		}

		#cf-legend {
			width:960px;
			height:100px;
		}

		.cf-legend-opt {
			width:30px;
			height:15px;
			padding:5px;
			float:left;
			margin:0 20px;
			border:1px solid #8c9b93;
		}

		.cf-legend-opt p {
			text-align:center;
			font-size:12px;
			font-weight:700;
			margin:30px 0 0 -10px;
		}

		.stacked-bar-chart {
			width:960px;
		}

		.stacked-bar-chart .bar-data {
			width:600px;
		}

		.bar-seg {
			height:30px;
			float:left;
		}

	/* --------CANDIDATE INTRO--------  */

		#cand-intro {
			padding-bottom: 20px;
			margin: 0 0 20px 0;
			display:none;
		}

			#cand-summary {
				width:700px;
				clear:right;
				line-height:18px;
				height:120px;
				margin:20px;
			}

				#cand-summary p {
					margin:0 0 15px 0;
				}

			#cand-header {
				width:540px;
			}

				#cand-header h2 {
					font-size:24px;
				}

				#cand-header h4 {
					font-size:16px;
					font-weight:300;
					color:#8c9b93;
					margin:10px 0 0 0;
				}


			#cand-photo {
				float:left;
				margin:20px;
				height:120px;
			}	

				#cand-photo img {
					border:1px solid #4c5b52;
					width:100px;
				}




		#cand-highlight {
			width:960px;
			height:300px;
			border-bottom:10px double #4c5b52;
			display:none;

		}

			#cand-highlight h2 {
				font-size:24px;
				margin:10px 0 0 0;
			}

			.highlights {
				float:left;
				width:300px;
				margin: 15px 19px 50px 0;
				height: 200px;
				border-right: solid 1px #8c9b93;
			}

			#cand-highlight div:last-of-type {
				border:none;
			}

				.highlights h4 {
					color:#4c5b52;
					font-size:67px;
					margin:50px 0 0 0;
					text-align:center;
				}

				.highlights p {
					color:#8c9b93;
					font-size:14px;
					margin:0 0 0 0;
					text-align:center;
				}

		#chart-footer {
		}		

	/* --------CF OVERVIEW--------  */
		#cf-container h2 {
			font-size:24px;
			margin:0 0 20px 0;
		}

		#cf-text {
			padding:20px 0 20px 0;
			border-bottom:solid 2px #4c5b52;
			line-height: 20px;
		}	

		#cand-chart {
			height:1px;
			border-bottom:solid 2px #4c5b52;
			border-top:10px double #4c5b52;
			visibility:hidden;
		}
		#cf-chart {
			height:1px;
			border-bottom:double 10px #4c5b52;
			border-top:10px double #4c5b52;
			visibility:hidden;
		}	

		#cf-choose {
		margin:10px 0 0 0;
		width:960px;
		height:35px;
	}

		#cf-draw {

		}

		#cf-summary {
			padding: 0 0 25px 0;
		}


		#cf-contribute {
			display:none;
			width:960px;
		}

		#cf-geography, #cf-expenses, #cf-achieve, #cf-employ {display:none;}


		.cf-detail {
			width: 200px;
			border: dashed 2px #4c5b52;
			float:left;
			padding: 0px;
			margin: 0 10px 0 0;
			cursor: pointer;
			background: #F8F7F1;
			text-align: center;
		}

		.cf-detail:hover {
			border:solid 2px #4c5b52;
		}

		.cf-detail p {
			color:#4C5B52;
			font-weight:900 !important;
			background:#d3d3d3;
		}

		.bar-chart {
			width:960px;
		}

		.cf-head {
			width:960px;
			height:120px;
		}
		
		.cf-stack-head {
			width:960px;
			height:170px;
		}

		.cf-title {
			width:960px;
		}

		.cf-title h2 {
			margin:0 0 0 0 !important;
			font-size:1.5em;
		}

		.cf-title h4 {
			font-family:"helvetica neue",helvetica,san-serif;
			font-weight:400;
			margin:0 0 20px 0 !important;
		}


		.bar-row, .stacked-bar-row {
			height:30px;
			margin:0 0 15px 0;

		}

		.pointer {
			cursor:pointer;

		}


		.bar-label {
			font-size:12px;
			text-align:right;
			border-right:1px solid #000;
			padding:0 10px 0 0;
			height:100%;
			float:left;
			margin:0 0 0 0;

		}

			.bar-label p {
				margin:10px 0
			}

		.bar-data {
			width:0;
			height:30px;
			float:left;
		}

			.bar-data p {
				text-align:right;
				font-size:14px;
				margin:6px 5px 6px 0;
				color:#000000;
				font-weight:700;
			}

		.chart-h4 {
			text-align: center;
			font-size: 36px;
			color: #91cf60;
		}

		.cf-infobox {
			float:left;
			width:280px;
			height:auto;
			margin:10px 10px 10px 10px;
			padding:8px;
			border:2px solid #8c9b93;
		}	

			.cf-infobox h4 {
				font-weight:400;
				font-size:18px;
				margin-bottom:10px;
			}

			.cf-infobox li span:first-of-type {
				font-weight:700;
			}


		#cf-industry, #cf-industry .drill-bar-chart {
			display:none;
		}

		.chart-footer {
			font-style:italic;
			font-size:12px;
			color:#8c9b93;
			margin:30px 0 15px 0;
		}
		
	#cf-options {
		float:left;
		width:960px;
		margin:0 0 10px 0;
	}

		#cf-options img {
			width:100px;
			height:100px;
			cursor:pointer;
			border:1px solid #4c5b52;
			opacity:0.4;
		}

		#cf-options div {
			margin:20px 15%;
			float:left;
			width:100px;
			height:125px;
		}

		#cf-options h4 {
			width:80px;
			margin:0 10px;
			text-align:center;
			font-size:12px;
			color:#4c5b52;
		}

		#cf-options img:hover {
			opacity:1;
		}
		
	.summary-row {
		height:125px;
		margin: 0 0 10px 0;
		padding: 0 0 10px 0;
		border-bottom: 1px solid #8c9b93;
	}
	.summary-row:last-of-type {
		border:none;
	}
		.summary-cell{
			width:24.863636364%;
			height:125px;
			float:left;
			border-left:1px solid #8c9b93;
		}
		.summary-cell:first-of-type {
			border:none;
		}
		.summary-cell p:first-of-type {
			text-align:center;
			font: 700 1.5em "helvetica neue";
			margin: 42px 0;
			color:#5FADCE;
		}
		.summary-cell img {
			margin:0 auto;
			width:75px;
			height:75px;
			border:1px solid #8c9b93;
		}
		.summary-cell p:last-of-type {
			text-align:center;
			font:300 .8em/1em "helvetica neue";
			color:#4c5b52;
		}
		.summary-cell:first-of-type p  {
			font:300 .8em/1em "helvetica neue";
			color:#4c5b52;
			width:88%;
			margin:12px 0;
			text-align:left;
		}
</style>

<div id="cf-container">
	<div id="loading">
		<h1><strong></strong></h1>
		<p>this should only take a moment</p>
	</div>
	<div id="cf-chart">
		<div id="cf-choose">
			<select id="race-options" class="chosen-select" style="width:200px;float:left;" tabindex="2">
				<option value="0">All</option>
				<option value="1">District Attorney</option>
				<option value="2">Supervisor: District 4</option>
				<option value="3">Supervisor: District 5</option>
			</select>
			<select id="overall-options" class="chosen-select" style="width:150px;float:left;" tabindex="2">
				<option value="Summary">Summary</option>
				<option value="Cash Raised">Cash Raised</option>
				<option value="Cash Spent">Cash Spent</option>
				<option value="Loans">Loans</option>
				<option value="Retirees">Retirees</option>
				<!--<option value="Contributors">Top Contributors</option>-->
				<option value="Geography">Geography</option>
			</select>
			<select id="stacked-options" class="chosen-select" style="width:180px;float:left;" tabindex="2">
				<option value="Percent of Contributions">Percent of Contributions</option>
				<option value="Total Contributions">Total Contributions</option>
			</select>
		</div>
		<div id="cf-overview" class="cf-canvas">
			<div class="cf-head">
				<div class="cf-title">
					<h2>Candidate Summary</h2>
					<h4></h4>
				</div>
			</div>
		</div>
		<div id="cf-summary" class="cf-canvas">
			<div class="bar-chart">
				<div class="cf-head">
					<div class="cf-title">
						<h2></h2>
						<h4></h4>
					</div>
				</div>	
			</div>
		</div>
		<div id="cf-stacked" class="cf-canvas">
			<div class="stacked-bar-chart">
				<div class="cf-stack-head">
					<div class="cf-title">
						<h2>Where Contributions Came From <br>(hover over bars for details)</h2>
						<h4></h4>
					</div>
					<div id="cf-legend">
						<div class="cf-legend-opt"><p></p></div>
						<div class="cf-legend-opt"><p></p></div>
						<div class="cf-legend-opt"><p></p></div>								
					</div>
				</div>
			</div>
		</div>
	</div>
</div>

<script>
		// ------- GLOBAL ------- //
			//input dimensions for graphic
			var dimensions = {
				overall:550, //entire app size
				label:125, //labels for bars
				maxBarWidth:400 //max bar length
			}
			//input options for stacked bar graphs
			var stackedControl = {
				geography:{
					footer:"Contributions show here refer to itemized contributions with a location attached. Humboldt refers to all donations from incorporated and unincorporated communities in Humboldt County. California contributions include all contributions from California EXCLUDING Humboldt County.",
					legendItems:3,
					legendLabels:["Humboldt","California","Elsewhere"],
					legendColor:["#91cf60","#5FADCE","#CE5F75"],
					legendBars:{
						two:"<div class=\"stacked-bar-row\" id=\"0\"><div class=\"bar-label\"><p class=\"the-label\"></p></div><div class=\"bar-data\"><div id=\"geo1\" class=\"bar-seg\"></div><div id=\"geo2\" class=\"bar-seg\"></div></div>",
						three:"<div class=\"stacked-bar-row\" id=\"0\"><div class=\"bar-label\"><p class=\"the-label\"></p></div><div class=\"bar-data\"><div id=\"geo1\" class=\"bar-seg\"></div><div id=\"geo2\" class=\"bar-seg\"></div><div id=\"geo3\" class=\"bar-seg\"></div></div></div>",
						four:"<div class=\"stacked-bar-row\" id=\"0\"><div class=\"bar-label\"><p class=\"the-label\"></p></div><div class=\"bar-data\"><div id=\"geo1\" class=\"bar-seg\"></div><div id=\"geo2\" class=\"bar-seg\"></div><div id=\"geo3\" class=\"bar-seg\"></div><div id=\"geo4\" class=\"bar-seg\"></div></div></div>"
					}
				}	
			}
			var raceTotal = [8,4,2,2]; //manually enter the number of candidates for each race, in order you placed in list above
			var raceColumns = [2,6,2,4]; // manually enter the column where this race data starts on the Summary sheet of GSheet
			var gsheet = "https://docs.google.com/spreadsheet/pub?key=0AnZDmytGK63SdFo3Tnl5cmpnZXUydVloYUZSZnR5RHc&output=html"; 
			var candidateDB = [], mainDB = []; //stores all summary data
			var updated = "3/17/2014"; //when was the data updated?
			var view = "Summary"; //leave default
			var race = 0; //leave default
			var stacked = 0; //leave default
		// ------- CHOSEN ------- //	
		$(document).ready(function(){
			var config = {
		      '.chosen-select'           : {},
		      '.chosen-select-deselect'  : {allow_single_deselect:true},
		      '.chosen-select-no-single' : {disable_search_threshold:10},
		      '.chosen-select-no-results': {no_results_text:'Oops, nothing found!'},
		      '.chosen-select-width'     : {width:"95%"}
		    }
		    for (var selector in config) {
		      $(selector).chosen(config[selector]);
		    }
		});
		// ------- ADJUST DIMENSIONS ------- //
		$(document).ready(function(){
			$("#loading").add("#cf-container").add("#cf-options").add("#cf-chart").add("#cf-legend").add(".stacked-bar-chart").add("#cand-highlight").add("#cf-options").add("#cf-choose").add("#cf-contribute").add(".bar-chart").add(".cf-stack-head").add(".cf-head").add(".cf-title").add("#cf-summary").add("#cf-overview").add(".summary-row").css("width",dimensions.overall);
		});
	// ------- FUNNY GREETINGS ------- //
		$(document).ready(function(){
			var random = Math.round(Math.random() * 10);
			if (random === 0){
				$("#loading h1:eq(0)").html("Scanning Disclosure Forms...");
			}
			else if (random === 1){
				$("#loading h1:eq(0)").html("Lubricating Political Wheels...");
			} 
			else if (random === 2){
				$("#loading h1:eq(0)").html("Connecting to Central Server...");
			}
			else if (random === 3){
				$("#loading h1:eq(0)").html("Circumventing NSA Snooping...");
			}
			else if (random === 4){
				$("#loading h1:eq(0)").html("Consulting Consultants...");
			}
			else if (random === 5){
				$("#loading h1:eq(0)").html("Populating Plazoids...");
			}
			else if (random === 6){
				$("#loading h1:eq(0)").html("Sizing Up War Chests...");
			}
			else if (random === 7){
				$("#loading h1:eq(0)").html("Crossing T's and Dotting I's...");
			}
			else if (random === 8){
				$("#loading h1:eq(0)").html("Verifying Accounting...");
			}
			else if (random === 9){
				$("#loading h1:eq(0)").html("Handshaking Good Ole Boys...");
			}
			else if (random === 10){
				$("#loading h1:eq(0)").html("Communicating Telepathically...");
			}
		});
	// ------- TABLETOP ------- //
		$(document).ready(function(){
				Tabletop.init( { key: gsheet,
			                     callback: setTheScene,
			                     wanted: ["Summary","Main"],
			                     debug: true } );
		});
	// ------- GET AND POPULATE CANDIDATE INFO ------- //
		function setTheScene(data, tabletop){
			//pull spreadsheet data into arrays
			$.each( tabletop.sheets("Summary").all(), function(i, summary) {
				var insertRow = [];
				insertRow[0] = summary.category;
				insertRow[1] = summary.all;
				insertRow[2] = summary.bass;
				insertRow[3] = summary.kerrigan;
				insertRow[4] = summary.latour;
				insertRow[5] = summary.sundberg;
				insertRow[6] = summary.dollison;
				insertRow[7] = summary.firpo;
				insertRow[8] = summary.fleming;
				insertRow[9] = summary.klein;
				candidateDB.push(insertRow);
			});
			
			$.each( tabletop.sheets("Main").all(), function(i, main) {
				var insertRow = [];
				insertRow[0] = main.item;
				insertRow[1] = main.all;
				insertRow[2] = main.bass;
				insertRow[3] = main.kerrigan;
				insertRow[4] = main.latour;
				insertRow[5] = main.sundberg;
				insertRow[6] = main.dollison;
				insertRow[7] = main.firpo;
				insertRow[8] = main.fleming;
				insertRow[9] = main.klein;
				mainDB.push(insertRow);
			});			
			
			//when last updated
			$(".cf-title h4").html("Data Updated on " + updated); 

			//loading
			$("#cf-chart").css("visibility","visible").css("height","auto");
			$("#loading").remove();
			
			//draw first chart
			resetSummaryBars(view);
			renameSummaryLabels(view);
			$(".bar-label").css("width",dimensions.label);
			$(".cf-canvas").css("display","none");
			$("#cf-overview").css("display","block");
			drawSummary();
		}
		
		function drawSummary(){
			var data = [];
			//size up data
			var ii = raceColumns[race];
				
			for (i=0 ; i < raceTotal[race]; i++){
				$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(0) img").attr("src", mainDB[2][ii]);
				var temp = parseInt(mainDB[22][ii]);
				$(".summary-row:eq("+i+")").attr("value",temp);
				data[i] = new Array();
				data[i][0] = "$" + commaSeparateNumber(temp);
				switch(race){
					case 0:
						data[i][1] = mainDB[23][ii];
						data[i][2] = mainDB[25][ii];
						break;
					case 1:
						data[i][1] = mainDB[24][ii];
						data[i][2] = mainDB[26][ii];
						break;
					case 2:
						data[i][1] = mainDB[24][ii];
						data[i][2] = mainDB[26][ii];
						break;
					case 3:
						data[i][1] = mainDB[24][ii];
						data[i][2] = mainDB[26][ii];
						break;
				}
				ii = ii + 1;
			}
			
			//populate data
			for (i=0 ; i < data.length ; i++){
				$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(1) p:eq(0)").html(data[i][0]);
				$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(2) p:eq(0)").html(data[i][1]);
				$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(3) p:eq(0)").html(data[i][2]);
				
				//Ranking colors
				if (data[i][1] === "1st"){
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(2) p:eq(0)").css("color","#91cf60");
				}
				else if (data[i][1] === "2nd" || data[i][1] === "3rd"){
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(2) p:eq(0)").css("color","#5FADCE");
				}
				else {
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(2) p:eq(0)").css("color","#CE5F75");
				}
				if (data[i][2] === "1st"){
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(3) p:eq(0)").css("color","#91cf60");
				}
				else if (data[i][2] === "2nd" || data[i][2] === "3rd"){
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(3) p:eq(0)").css("color","#5FADCE");
				}
				else {
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(3) p:eq(0)").css("color","#CE5F75");
				}
			}
			sortSummary();
		}

		function drawContributions(){
			var data = [];
			var all = 0;
			var dataWidth = [];
			var commas = [];

			//size up data
			var ii = raceColumns[race];
			for (i=0 ; i < raceTotal[race]; i++){
				data[i] = parseInt(candidateDB[5][ii]) + parseInt(candidateDB[11][ii]);
				commas[i] = commaSeparateNumber(data[i]);
				ii = ii + 1;
			}

			//find total
			for (i=0 ; i < data.length ; i++){
				all = all + data[i]
			}
			
			//find highest value in array
			var maxValue = Math.max.apply(null, data);
			
			//figure out the width for each bar
			for (i = 0 ; i < data.length ; i++){
				dataWidth[i] = (data[i] / maxValue) * dimensions.maxBarWidth;
			}

			//populate data
			for (i=0 ; i < data.length ; i++){
				$("#cf-summary .bar-row:eq(" + i + ")").attr("value",data[i]);
				$("#cf-summary .bar-data:eq(" + i + ") p").text("$" + commas[i]);
				$("#cf-summary .bar-data:eq(" + i + ")").animate({
					width:dataWidth[i]
				})
			}
			
			//meta
			$(".bar-data").css("background","#91cf60");
			$("#cf-summary .cf-title h2").text("Total Cash Raised 2013-14");
			$("#cf-summary").append("<h4 class=\"chart-h4\">$" + commaSeparateNumber(all) + " contributed total</h4>");
			$("#cf-summary").append("<p class=\"chart-footer\">Cash raised includes all cash raised by the candidate excluding non-monetary contributions and loans, but including miscellaneous increases in cash, usually from auctioning items given to a candidate through non-monetary contributions.</p>");
			sortBars();
		}

		function drawLoans(){
			var data = [];
			var all = 0;
			var dataWidth = [];
			var commas = [];

			//size up data
			var ii = raceColumns[race];
			for (i=0 ; i < raceTotal[race]; i++){
				data[i] = parseInt(candidateDB[12][ii]);
				commas[i] = commaSeparateNumber(data[i]);
				ii = ii + 1;
			}
			console.log(data)
			//find total
			for (i=0 ; i < data.length ; i++){
				all = all + data[i]
			}
			
			//find highest value in array
			var maxValue = Math.max.apply(null, data);
			
			//figure out the width for each bar
			for (i = 0 ; i < data.length ; i++){
				dataWidth[i] = (data[i] / maxValue) * dimensions.maxBarWidth;
			}

			//populate data
			for (i=0 ; i < data.length ; i++){
				$("#cf-summary .bar-row:eq(" + i + ")").attr("value",data[i]);
				$("#cf-summary .bar-data:eq(" + i + ") p").text("$" + commas[i]);
				$("#cf-summary .bar-data:eq(" + i + ")").animate({
					width:dataWidth[i]
				})
			}
			
			
			//meta
			$(".bar-data").css("background","#5FADCE");
			$("#cf-summary .cf-title h2").text("Loans: 2013-14");
			$("#cf-summary").append("<h4 class=\"chart-h4\" style=\"color:#5FADCE;>$" + commaSeparateNumber(all) + " contributed total</h4>");
			$("#cf-summary").append("<p class=\"chart-footer\">A candidate or others can loan money to a committee, but that loan must be paid off by a predesignated time, such as through contributions.</p>");
			sortBars();
		}

		function drawRetired(){
			var data = [];
			var all = 0;
			var dataWidth = [];
			var commas = [];

			//size up data
			var ii = raceColumns[race];
			for (i=0 ; i < raceTotal[race]; i++){
				data[i] = parseInt(mainDB[21][ii]);
				commas[i] = commaSeparateNumber(data[i]);
				ii = ii + 1;
			}
			console.log(data)
			//find total
			for (i=0 ; i < data.length ; i++){
				all = all + data[i]
			}
			
			//find highest value in array
			var maxValue = Math.max.apply(null, data);
			
			//figure out the width for each bar
			for (i = 0 ; i < data.length ; i++){
				dataWidth[i] = (data[i] / maxValue) * dimensions.maxBarWidth;
			}

			//populate data
			for (i=0 ; i < data.length ; i++){
				$("#cf-summary .bar-row:eq(" + i + ")").attr("value",data[i]);
				$("#cf-summary .bar-data:eq(" + i + ") p").text("$" + commas[i]);
				$("#cf-summary .bar-data:eq(" + i + ")").animate({
					width:dataWidth[i]
				})
			}
			
			//meta
			$(".bar-data").css("background","#91cf60");
			$("#cf-summary .cf-title h2").text("Total Cash from Retirees: 2013-14");
			$("#cf-summary").append("<h4 class=\"chart-h4\">$" + commaSeparateNumber(all) + " contributed total</h4>");
			$("#cf-summary").append("<p class=\"chart-footer\">Cash raised includes all cash raised by the candidate excluding non-monetary contributions and loans, but including miscellaneous increases in cash, usually from auctioning items given to a candidate through non-monetary contributions.</p>");
			sortBars();
		}

		function drawSpent(){
			var data = [];
			var all = 0;
			var dataWidth = [];
			var commas = [];

			//size up data
			var ii = raceColumns[race];
			for (i=0 ; i < raceTotal[race] ;  i++){
				data[i] = parseInt(candidateDB[20][ii]);
				commas[i] = commaSeparateNumber(data[i]);
				ii = ii + 1;
			}

			//find total
			for (i=0 ; i < data.length ; i++){
				all = all + data[i]
			}
			
			//find highest value in array
			var maxValue = Math.max.apply(null, data);
			
			//figure out the width for each bar
			for (i = 0 ; i < data.length ; i++){
				dataWidth[i] = (data[i] / maxValue) * dimensions.maxBarWidth;
				console.log(dataWidth[i])
			}

			//populate data
			for (i=0 ; i < data.length ; i++){
				$("#cf-summary .bar-row:eq(" + i + ")").attr("value",data[i]);
				$("#cf-summary .bar-data:eq(" + i + ") p").text("$" + commas[i]);
				$("#cf-summary .bar-data:eq(" + i + ")").animate({
					width:dataWidth[i]
				})
			}
			
			$("#cf-summary .bar-data").css("background","#CE5F75");
			$("#cf-summary .cf-title h2").text("Total Cash Spent 2013-14");
			$("#cf-summary").append("<h4 class=\"chart-h4\" style=\"color:#CE5F75;\">$" + commaSeparateNumber(all) + " spent total</h4>");
			$("#cf-summary").append("<p class=\"chart-footer\">Cash spent includes all expenses excluding accured expenses. Numbers are rounded to nearest dollar.</p>");
			sortBars();
		}

		function drawGeography(){
			var data = [], dataWidth = [], total = [], commas = [], colors = [], dataWidth = [];
			//unhide stacked option
			$("#stacked_options_chosen").css("visibility","visible");		
			if (stacked === 0){
				//size up data
				var ii = raceColumns[race];
				for (i=0 ; i < raceTotal[race] ;  i++){
					data[i] = new Array();
					commas[i] = new Array();
					data[i][0] = parseInt(candidateDB[21][ii]);
					data[i][1] = parseInt(candidateDB[23][ii]);
					data[i][2] = parseInt(candidateDB[24][ii]);
					commas[i][0] = commaSeparateNumber(data[i][0]);
					commas[i][1] = commaSeparateNumber(data[i][1]);
					commas[i][2] = commaSeparateNumber(data[i][2]);
					ii = ii + 1;
				}
				//calculate the total for each candidate
				for (i=0 ; i < raceTotal[race] ; i++){
					total[i] = (data[i][0] + data[i][1] + data[i][2]);
				}
				//sorting by first legend item
				for (i=0 ; i < raceTotal[race] ; i++){
					$("#cf-stacked .stacked-bar-row:eq(" + i + ")").attr("value",((data[i][0] / total[i]) * 100));
				}
				//populate data
				colors = stackedControl.geography.legendColor;
				for (i=0 ; i < raceTotal[race] ; i++){
					for (x = 0 ; x < stackedControl.geography.legendItems ; x++){
						$("#cf-stacked .stacked-bar-row:eq(" + i + ") .bar-seg:eq(" + x + ")").css("background",colors[x] ).animate({
							width:((data[i][x] / total[i]) * 100) + "%"
						}).attr("value", data[i][x]);
						$("#cf-stacked .stacked-bar-row:eq(" + i + ") .bar-seg:eq(" + x + ")").caltip({
							title:stackedControl.geography.legendLabels[x],
							content:"$" + commas[i][x] + " (" + Math.round(((data[i][x] / total[i]) * 100)) + "%" + ")"
						})
					}
				}
				//footer
				$("#cf-stacked").append("<p class=\"chart-footer\">" + stackedControl.geography.footer + "</p>");
			}		
			else if (stacked === 1){
				//size up data
				var ii = raceColumns[race];
				for (i=0 ; i < raceTotal[race] ;  i++){
					data[i] = new Array();
					commas[i] = new Array();
					data[i][0] = parseInt(candidateDB[21][ii]);
					data[i][1] = parseInt(candidateDB[23][ii]);
					data[i][2] = parseInt(candidateDB[24][ii]);
					commas[i][0] = commaSeparateNumber(data[i][0]);
					commas[i][1] = commaSeparateNumber(data[i][1]);
					commas[i][2] = commaSeparateNumber(data[i][2]);
					ii = ii + 1;
				}
				//calculate the total for each candidate
				for (i=0 ; i < raceTotal[race] ; i++){
					total[i] = (data[i][0] + data[i][1] + data[i][2]);
				}
				//sorting by first legend item
				for (i=0 ; i < raceTotal[race] ; i++){
					$("#cf-stacked .stacked-bar-row:eq(" + i + ")").attr("value",((data[i][0] / total[i]) * 100));
				}
				//find highest value in array
				var maxValue = Math.max.apply(null, total);
				//figure out the width for each bar
				for (i = 0 ; i < total.length ; i++){
					dataWidth[i] = (total[i] / maxValue) * dimensions.maxBarWidth;
				}
				//populate data
				colors = stackedControl.geography.legendColor;
				for (i=0 ; i < raceTotal[race] ; i++){
					for (x = 0 ; x < stackedControl.geography.legendItems ; x++){
						$("#cf-stacked .stacked-bar-row:eq(" + i + ") .bar-seg:eq(" + x + ")").css("background",colors[x] ).animate({
							width:((data[i][x] / total[i]) * 100) + "%"
						}).attr("value", data[i][x]);
						$("#cf-stacked .stacked-bar-row:eq(" + i + ") .bar-seg:eq(" + x + ")").caltip({
							title:stackedControl.geography.legendLabels[x],
							content:"$" + commas[i][x] + " (" + Math.round(((data[i][x] / total[i]) * 100)) + "%" + ")"
						})
					}
				}				
				for (i=0 ; i < total.length ; i++){
					$("#cf-stacked .stacked-bar-row:eq(" + i + ")").attr("value",total[i]);
					$("#cf-stacked .bar-data:eq(" + i + ")").animate({
						width:dataWidth[i] + "px"
					})
				}
				//footer
				$("#cf-stacked").append("<p class=\"chart-footer\">" + stackedControl.geography.footer + "</p>");
			}		
			sortGeo();
			
		}

		function resetSummaryBars(view){
			//visibility stacked option
			$("#stacked_options_chosen").css("visibility","hidden");
			//reset text and colors for chart
			$(".chart-h4").add(".chart-footer").add(".bar-row").add(".stacked-bar-row").add(".cf-legend-opt").add(".summary-row").remove();

			if (view === "Cash Raised" || view === "Retirees" || view === "Loans" || view === "Cash Spent"){
				for (i = 1 ; i < raceTotal[race] + 1; i++){
					$("#cf-summary .bar-chart").append("<div class=\"bar-row\" id=\"" + i + "\"><div class=\"bar-label\"><p class=\"the-label\"></p></div><div class=\"bar-data\"><p></p></div></div>");
				}
			}		
			else if (view === "Geography"){
				var geographyStackedSubBars;
				//determine number of stacked sub bars
				switch(stackedControl.geography.legendItems){
					case 2:
						geographyStackedSubBars = stackedControl.geography.legendBars.two;
						break;
					case 3:
						geographyStackedSubBars = stackedControl.geography.legendBars.three;
						break;
					case 4:
						geographyStackedSubBars = stackedControl.geography.legendBars.four;
						break;
				}
				//populate bars based on number of candidates
				for (i = 1 ; i < raceTotal[race] + 1; i++){
					$(".stacked-bar-chart").append(geographyStackedSubBars);
				}				
				//tag each row with unique ID
				for (i = 1 ; i < raceTotal[race] + 1; i++){
					$("#cf-stacked .stacked-bar-row:eq(" + i + ")").attr("id", i);
				}
				//Give Max Width to Bars
				$(".stacked-bar-row").css("width", dimensions.overall);
				$(".stacked-bar-row .bar-data").css("width", dimensions.maxBarWidth);
				//populate legend
				for (i = 0 ; i < stackedControl.geography.legendItems ; i++){
					$("#cf-legend").append("<div class=\"cf-legend-opt\"><p>" + stackedControl.geography.legendLabels[i] + "</p></div>");
					$(".cf-legend-opt:eq(" + i + ")").css("background", stackedControl.geography.legendColor[i]);
				}
	
			}			
			else if (view === "Summary"){
				for (i = 1 ; i < raceTotal[race] + 1; i++){
					$("#cf-overview").append("<div class=\"summary-row\" id=\""+i+"\"><div class=\"summary-cell\"><img src=\"\"><p></p><p></p></div><div class=\"summary-cell\"><p></p><p>War Chest</p></div><div class=\"summary-cell\"><p></p><p>Cash Raised</p></div><div class=\"summary-cell\"><p></p><p>Cash Spent</p></div></div>");
				}
			}
			//resize labels
			$(".bar-label").css("width",dimensions.label);			
		}

		function renameSummaryLabels(view){
			var ii = raceColumns[race];
			if (view === "Cash Raised" || view === "Cash Spent" || view === "Retirees" || view === "Loans"){
				for (i = 0; i < raceTotal[race]; i++){
					$("#cf-summary .bar-row:eq("+ i +") .bar-label p").html(candidateDB[0][ii]);
					ii = ii + 1;
				}
			}
			else if (view === "Geography"){
				for (i = 0; i < raceTotal[race]; i++){
					$("#cf-stacked .stacked-bar-row:eq("+ i +") .bar-label p").html(candidateDB[0][ii]);
					ii = ii + 1;
				}
			}
			else if (view === "Summary"){
				for (i = 0; i < raceTotal[race]; i++){
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(0) p:eq(0)").html(candidateDB[0][ii]);
					$("#cf-overview .summary-row:eq("+ i +") .summary-cell:eq(0) p:eq(1)").html(candidateDB[1][ii]);
					ii = ii + 1;
				}
			}
			
			
		}

		function sortSummary(){
			var $wrapper = $('#cf-overview'),
		        $articles = $wrapper.find('.summary-row');
		    [].sort.call($articles, function(a,b) {
		        return +$(b).attr('value') - +$(a).attr('value');
		    });
		    $articles.each(function(){
		        $wrapper.append(this);
		    });
		}

		function sortBars(){
			var $wrapper = $('.bar-chart'),
		        $articles = $wrapper.find('.bar-row');
		    [].sort.call($articles, function(a,b) {
		        return +$(b).attr('value') - +$(a).attr('value');
		    });
		    $articles.each(function(){
		        $wrapper.append(this);
		    });
		}

		function sortGeo(){
			//percent or total sort
			if (stacked === 0){
				var $wrapper = $('.stacked-bar-chart'),
			        $articles = $wrapper.find('.stacked-bar-row');
			    [].sort.call($articles, function(a,b) {
			        return +$(b).attr('value') - +$(a).attr('value');
			    });
			    $articles.each(function(){
			        $wrapper.append(this);
			    });
			}
			else {
				var $wrapper = $('.stacked-bar-chart'),
			        $articles = $wrapper.find('.stacked-bar-row');
			    [].sort.call($articles, function(a,b) {
			        return +$(b).attr('value') - +$(a).attr('value');
			    });
			    $articles.each(function(){
			        $wrapper.append(this);
			    });
			}
		}
	// ------- COMMAS!!------- //
		function commaSeparateNumber(val){
		    while (/(\d+)(\d{3})/.test(val.toString())){
		      val = val.toString().replace(/(\d+)(\d{3})/, '$1'+','+'$2');
		    }
		    return val;
		}
	// ------- WHAT TO DRAW?------- //
		function redrawCanvas(){
			//magically hide and show chart divs
			$("#cf-summary .bar-chart").css("display","block");
			$("#cf-industry .drill-bar-chart").css("display","none");
			$("#cf-summary").css("display","block");
			$("#cf-industry").css("display","none");
			//Change view
			if (view === "Cash Raised"){
				resetSummaryBars(view);
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-summary").css("display","block");
				drawContributions()
			}
			else if (view === "Top Contributors"){
				resetSummaryBars(view);
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-contribute").css("display","block");
				$("#cf-contribute").append("<p class=\"chart-footer\">Top employers include the total number of contributions from both individuals who work for the employer and contributions made by the employer itself. Contributions where a person who identified themself as Retired have been excluded from this list as it is an entire category in and of itself. Average amount per contribution based off of all reported contributions; contributions under $100 typically don't have to be reported.</p>");
			}
			else if (view === "Summary"){
				resetSummaryBars(view);
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-overview").css("display","block");
				drawSummary();
			}
			else if (view === "Loans"){
				resetSummaryBars(view);
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-summary").css("display","block");
				drawLoans();
			}
			else if (view === "Retirees"){
				resetSummaryBars(view);
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-summary").css("display","block");
				drawRetired();
			}
			else if (view === "Geography"){
				$(".cf-canvas").css("display","none");
				$("#cf-stacked").css("display","block");
				resetSummaryBars(view);
				renameSummaryLabels(view);
				drawGeography();
			}
			else if (view === "Cash Spent"){
				resetSummaryBars(view)
				renameSummaryLabels(view);
				$(".cf-canvas").css("display","none");
				$("#cf-summary").css("display","block");
				drawSpent()
			}
			else if (view === "Achievements"){
				$(".cf-canvas").css("display","none");
				$("#cf-achieve").css("display","block").animate({
					height:300
				});
			}
		}
	// ------- CHART SHIFTING------- //
		$(document).ready(function(){
			$("#race_options_chosen").on("click","ul > li", function(){
				race = parseInt($(this).attr("value"));	
				redrawCanvas();			
			})
			
			$("#overall_options_chosen").on("click","ul > li", function(){
				view = $(this).html(); //detect view
				redrawCanvas();
			})
			
			$("#stacked_options_chosen").on("click","ul > li", function(){
				var $x = $(this).html(); //detect view
				if ($x === "Percent of Contributions"){
					stacked = 0;
				}
				else {
					stacked = 1;
				}
				redrawCanvas();
			})
		});
</script>
